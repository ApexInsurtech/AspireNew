<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Apex Labs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- App favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">
  <!-- C3 charts css -->
  <link href="/plugins/c3/c3.min.css" rel="stylesheet" type="text/css"  />
  <!-- App css -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/icons.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/metismenu.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/style_light.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/spinkit.css" rel="stylesheet" type="text/css" />
  <link href="/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">
  <script src="/assets/js/modernizr.min.js"></script>
  <!-- DataTables -->
  <link href="/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css"/>
  <link href="/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Begin page -->
<div id="wrapper">
  <!-- Top Bar Start -->
  <div class="topbar">
  <!-- LOGO -->
  <div class="topbar-left">
    <a href="index.html" class="logo">
    <span>
      <img src="assets/images/logo.png" alt="" height="25">
    </span>
    <i>
      <img src="assets/images/logo_sm.png" alt="" height="28">
    </i>
    </a>
  </div>
  <nav class="navbar-custom">
    <ul class="list-inline float-right mb-0">
    <li class="list-inline-item notification-list">
      <a class="nav-link dropdown-toggle arrow-none waves-light waves-effect" href="/chat.html" role="button" aria-haspopup="false" aria-expanded="false"><i class="dripicons-message noti-icon"></i></a>
    </li>
    <li class="list-inline-item dropdown notification-list">
      <a class="nav-link dropdown-toggle waves-effect waves-light nav-user" data-toggle="dropdown" href="#" role="button"
       aria-haspopup="false" aria-expanded="false">
      <img src="assets/images/users/avatar-5.jpg" alt="user" class="rounded-circle">
      </a>
      <div class="dropdown-menu dropdown-menu-right profile-dropdown " aria-labelledby="Preview">
      <div class="dropdown-item noti-title">
        <h5 class="text-overflow"><small>Welcome User!</small> </h5>
      </div>
      </div>
    </li>
    </ul>
    <ul class="list-inline menu-left mb-0">
    <li class="float-left">
      <button class="button-menu-mobile open-left waves-light waves-effect">
      <i class="dripicons-menu"></i>
      </button>
    </li>
    </ul>
  </nav>
  </div>
  <div class="left side-menu">
  <div class="slimscroll-menu" id="remove-scroll">
    <div id="sidebar-menu">
    <ul class="metismenu" id="side-menu">
      <li class="menu-title">Navigation</li>
      <li>
      <a href="index.html">
        <i class="fi-air-play"></i><span> Dashboard </span>
      </a>
      </li>
      <li>
        <a href="proposals.html"><i class="fi-briefcase"></i> <span> Proposals </span></a>
      </li>
      <li>
        <a href="#"><i class="fi-briefcase"></i> <span> Policies </span></a>
      </li>
      <li>
        <a href="claims.html"><i class="fi-briefcase"></i> <span> Claims </span></a>
      </li>
      <li>
        <a href="#"><i class="fi-briefcase"></i> <span> Accounting </span></a>
      </li>
    </ul>
    </div>
    <div class="clearfix"></div>
  </div>
  </div>
  <div class="content-page">
  <!-- Start content -->
  <div class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
        <div class="page-title-box">
          <div class="float-left"><h4 class="page-title">Claims</h4></div>
          <div class="float-right">
          <span class="sk-three-bounce text-center mr-2" id="page-loader">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
          </span>
          <button class="btn btn-primary" id="btnAddClaim"><i class="fa fa-plus"></i> Add Claim</button>
          </div>
          <div class="clearfix"></div>
        </div>
        </div>
      </div>
      <!-- end row -->
      <div class="row">
        <div class="card-box col-12">
          <h4 class="header-title m-b-15 m-t-0">Stats</h4>
          <div class="row text-center">
            <div class="col-xs-6 col-sm-3">
              <div class="m-t-20 m-b-20">
                <h3 id="claim_total" class="m-b-10"></h3>
                <p class="text-uppercase m-b-5 font-13 font-600">Total Claims</p>
              </div>
            </div>
            <div class="col-xs-6 col-sm-3">
              <div class="m-t-20 m-b-20">
                <h3 id="claim_coverage" class="m-b-10"></h3>
                <p class="text-uppercase m-b-5 font-13 font-600">Coverage Amount of All Claims</p>
              </div>
            </div>
            <div class="col-xs-6 col-sm-3">
              <div class="m-t-20 m-b-20">
                <h3 id="claim_reserve" class="m-b-10"></h3>
                <p class="text-uppercase m-b-5 font-13 font-600">Reserve Amount</p>
              </div>
            </div>
            <div class="col-xs-6 col-sm-3">
              <div class="m-t-20 m-b-20">
                <h3 id="claim_ratio" class="m-b-10"></h3>
                <p class="text-uppercase m-b-5 font-13 font-600">Claim Ratio</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="card-box col-12 dataTables_wrapper container-fluid dt-bootstrap4 no-footer">
          <table id="claims-table" class="table table-hover m-0 tickets-list table-actions-bar dt-responsive nowrap dataTable no-footer dtr-inline collapsed">
            <thead>
              <tr>
                <th>Moderator</th>
                <th>Coverage Amount</th>
                <th>Loss Amount</th>
                <th>Policies</th>
                <th>Parties</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div> <!-- container -->
  </div> <!-- content -->
  <!-- Button trigger modal -->  
  <!-- Modal -->
  <!-- <div class="modal fade" id="add-claim" tabindex="-1" role="dialog" aria-labelledby="add_claim" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Claim</h5>
        <span class="sk-three-bounce text-center mr-2" id="loader-claim-add">
          <div class="sk-child sk-bounce1"></div>
          <div class="sk-child sk-bounce2"></div>
          <div class="sk-child sk-bounce3"></div>
        </span>
      </div>
      <div class="modal-body">
        <div id="default-wizard">
          <fieldset title="1">
            <legend>Claimant Details</legend>
            <div class="row m-t-20">
              <div class="form-group col-md-6">
                <label for="firstname">First Name</label>
                <input type="text" class="form-control" name="firstname" placeholder="">
              </div>
              <div class="form-group col-md-6">
                <label for="username">Last Name</label>
                <input type="text" class="form-control" id="lastname" placeholder="">
              </div>
              <div class="form-group col-md-6">
                <label for="lastname">Address</label>
                <input type="text" class="form-control" id="address" placeholder="">
              </div>
              <div class="form-group col-md-6">
                <label for="phonenumber">Phone Number</label>
                <input type="number" class="form-control" id="phonenumber" placeholder="">
              </div>
            </div>
          </fieldset>
          <fieldset title="2">
            <legend>Information</legend>
            <div class="row m-t-20">
              <div class="form-group col-md-6">
                <label for="description">Event Description</label>
                <textarea name="description" class="form-control" id="" cols="30" rows="10"></textarea>
              </div>
              <div class="form-group col-md-6">
                <label for="policies">Policy ID</label>
                <select class="form-control" name="policies" multiple></select>
              </div>
            </div>
          </fieldset>
          <button id="btnAddClaimE" class="btn btn-primary stepy-finish">Submit</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
    </div>
  </div> -->
  <!-- Modal -->
  <div class="modal fade" id="modal-add-member" tabindex="-1" role="dialog" aria-labelledby="add_member" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Members</h5>
          <span class="sk-three-bounce text-center mr-2" id="loader-add-member">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
          </span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="">Members</label>
            <select class="form-control" name="members"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" id="btnAddMember" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="modal-add-policy" tabindex="-1" role="dialog" aria-labelledby="add_policy" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Policies</h5>
          <span class="sk-three-bounce text-center mr-2" id="loader-add-polcies">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
          </span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="">Policies (Applicant Name)</label>
            <select class="form-control" name="policies"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" id="btnAddPolicy" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="modal-add-loss" tabindex="-1" role="dialog" aria-labelledby="add_loss" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Loss Amount</h5>
          <span class="sk-three-bounce text-center mr-2" id="loader-add-loss">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
          </span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="">Loss Amount</label>
            <input type="number" class="form-control" name="amount" aria-describedby="helpId" placeholder="In Numbers">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" id="btnAddLoss" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer text-right">
    2019 &copy; Apex Labs
  </footer>
  </div>
</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/popper.min.js"></script><!-- Popper for Bootstrap -->
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/metisMenu.min.js"></script>
<script src="/assets/js/waves.js"></script>
<script src="/assets/js/jquery.slimscroll.js"></script>
<script src="/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<!-- Counter js  -->
<script src="/plugins/waypoints/jquery.waypoints.min.js"></script>
<script src="/plugins/counterup/jquery.counterup.min.js"></script>
<script src="/plugins/jquery.stepy/jquery.stepy.min.js" type="text/javascript"></script>
<!--C3 Chart-->
<script type="text/javascript" src="/plugins/d3/d3.min.js"></script>
<script type="text/javascript" src="/plugins/c3/c3.min.js"></script>
<!--Echart Chart-->
<script src="/plugins/echart/echarts-all.js"></script>
<!-- Dashboard init -->
<script src="/assets/pages/jquery.dashboard.js"></script>
<!-- Datatable -->
<script src="/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/plugins/datatables/dataTables.bootstrap4.min.js"></script>
<script src="/plugins/datatables/dataTables.responsive.min.js"></script>
<!-- App js -->
<script src="/assets/js/jquery.core.js"></script>
<script src="/assets/js/jquery.app.js"></script>
<script>
  var dtClaims;
  $(function(){
    // INIT LOADERS
    $.fn.stepy.defaults.legend = false;
    $.fn.stepy.defaults.transition = 'fade';
    $.fn.stepy.defaults.duration = 200;
    $.fn.stepy.defaults.backLabel = '<i class="mdi mdi-arrow-left-bold"></i> Back';
    $.fn.stepy.defaults.nextLabel = 'Next <i class="mdi mdi-arrow-right-bold"></i>';
    $('#default-wizard').stepy();
    $('.stepy-navigator').find('.button-next').addClass('btn btn-primary waves-effect waves-light');
    $('.stepy-navigator').find('.button-back').addClass('btn btn-default waves-effect pull-left');
    $(".sk-three-bounce").hide();
    $(".dp").datepicker({
      format: "yyyy-mm-dd",
      autoclose: true,
      todayHighlight: true
    });
    $.ajax({
      "url": "/claims/stats",
      "method": "post",
      "success": function(response){
        for(let s in response){
          $("#claim_"+s).html(response[s]);
        }
      }
    });
    $.ajax({
      "url": "/claims/policies",
      "method": "post",
      "success": function(response){
        let d = "";
        $("select[name=policies]").html("");
        for(let s of response){
          d += "<option value=\"" + s["id"] + "\">"+ s["applicant_name"] +"<option>"
        }
        $("select[name=policies]").html(d);
      }
    });
    dtClaims = $("table#claims-table").DataTable({
      "ajax": {
        "url": "/claims/list",
        "method": "post"
      },
      "columns": [
        { "data": "moderator" },
        { "data": "coverage_amt" },
        { "data": "loss_amount" },
        { "data": "policies" },
        { "mRender": function(data, type, row){
          return row["parties"].join(", ");
        }},
        { "mRender": function(data, type, row){
          if(row["open"]) {
            return "<span class=\"label label-success\">Open</span>";
          }else{
            return "<span class=\"label label-muted\">Closed</span>";
          }
        }},
        { "mRender": function(data, type, row){
          let button = "<button type=\"button\" data-claim-id=\""+row["id"]+"\" class=\"btn btn-icon btn-default btn-add-members\"><i class=\"mdi mdi-account-multiple-plus\"></i></button>";
          button += "<button type=\"button\" data-claim-id=\""+row["id"]+"\" class=\"btn btn-icon btn-default btn-add-policies\"><i class=\"mdi mdi-playlist-plus\"></i></button>";
          button += "<button type=\"button\" data-claim-id=\""+row["id"]+"\" class=\"btn btn-icon btn-default btn-add-loss\"><i class=\"mdi mdi-cash\"></i></button>";
          return button;
        }},
      ]
    });
    // EVENTS
    $("#btnAddClaim").on("click", async function(){
      $("#loader-claim-add").show();
      await $.ajax({
        url: "/claims/add",
        method: "post",
      });
      dtClaims.ajax.reload();
      $("#loader-claim-add").hide();
    });
    $("body").on("click", ".btn-add-members", async function(){
      let claim_id= $(this).data("claim-id");
      let members = await $.ajax({
        url: "/claims/members",
        method: "post",
      });
      $("select[name=members]").html();
      for(let party of members){
        $("select[name=members]").append("<option>"+party+"</option>");
      }
      $("#modal-add-member").modal("show");
      $("#btnAddMember").data("claim-id", claim_id)
    });
    $("#btnAddMember").on("click", async function(e){
      $("#loader-add-member").show();
      let claim_id= $(this).data("claim-id");
      await $.ajax({
        url: "/claims/add-member",
        method: "post",
        data: JSON.stringify({
          "claim_id": claim_id,
          "member": $("select[name=members]").val(),
        }),
        dataType: "json",
        contentType: 'application/json',
        processData: false,
      });
      $("#loader-add-member").hide();
      dtClaims.ajax.reload();
      $("#modal-add-member").modal("hide");
    });
    $("body").on("click", ".btn-add-policies", async function(){
      let claim_id= $(this).data("claim-id");
      let members = await $.ajax({
        url: "/claims/policies",
        method: "post",
      });
      $("select[name=policies]").html();
      for(let party of members){
        $("select[name=members]").append("<option value=\""+party["id"]+"\">"+party["applicant_name"]+"</option>");
      }
      $("#modal-add-policy").modal("show");
      $("#btnAddPolicy").data("claim-id", claim_id)
    });
    $("#btnAddPolicy").on("click", async function(e){
      $("#loader-add-polcies").show();
      let claim_id= $(this).data("claim-id");
      await $.ajax({
        url: "/claims/add-policy",
        method: "post",
        data: JSON.stringify({
          "claim_id": claim_id,
          "policy_id": $("select[name=policies]").val(),
        }),
        dataType: "json",
        contentType: 'application/json',
        processData: false,
      });
      $("#loader-add-polcies").hide();
      dtClaims.ajax.reload();
      $("#modal-add-policy").modal("hide");
    });
    $("body").on("click", ".btn-add-loss", async function(){
      let claim_id= $(this).data("claim-id");
      $("#modal-add-loss").modal("show");
      $("#btnAddLoss").data("claim-id", claim_id)
    });
    $("#btnAddLoss").on("click", async function(e){
      $("#loader-add-loss").show();
      let claim_id= $(this).data("claim-id");
      await $.ajax({
        url: "/claims/add-loss",
        method: "post",
        data: JSON.stringify({
          "claim_id": claim_id,
          "amount": parseInt($("input[name=amount]").val()),
        }),
        dataType: "json",
        contentType: 'application/json',
        processData: false,
      });
      $("#loader-add-loss").hide();
      dtClaims.ajax.reload();
      $("#modal-add-loss").modal("hide");
    });
  });
</script>
</body>
</html>