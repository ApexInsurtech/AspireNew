<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Apex Insure Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- App favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">
  <!-- C3 charts css -->
  <link href="/plugins/c3/c3.min.css" rel="stylesheet" type="text/css"  />
  <!-- App css -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/icons.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/metismenu.min.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />
  <link href="/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">
  <script src="/assets/js/modernizr.min.js"></script>
</head>
<body>
<!-- Begin page -->
<div id="wrapper">
  <!-- Top Bar Start -->
  <div class="topbar">
    <!-- LOGO -->
    <div class="topbar-left">
      <a href="index.html" class="logo">
        <span>
          <img src="assets/images/logo.png" alt="" height="25">
        </span>
        <i>
          <img src="assets/images/logo_sm.png" alt="" height="28">
        </i>
      </a>
    </div>
    <nav class="navbar-custom">
      <ul class="list-inline float-right mb-0">
        <li class="list-inline-item dropdown notification-list">
          <a class="nav-link dropdown-toggle waves-effect waves-light nav-user" data-toggle="dropdown" href="#" role="button"
             aria-haspopup="false" aria-expanded="false">
            <img src="assets/images/users/avatar-1.jpg" alt="user" class="rounded-circle">
          </a>
          <div class="dropdown-menu dropdown-menu-right profile-dropdown " aria-labelledby="Preview">
            <div class="dropdown-item noti-title">
              <h5 class="text-overflow"><small>Welcome User!</small> </h5>
            </div>
          </div>
        </li>
      </ul>
      <ul class="list-inline menu-left mb-0">
        <li class="float-left">
          <button class="button-menu-mobile open-left waves-light waves-effect">
            <i class="dripicons-menu"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>
  <div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
      <div id="sidebar-menu">
        <ul class="metismenu" id="side-menu">
          <li class="menu-title">Navigation</li>
          <li>
            <a href="index.html">
              <i class="fi-air-play"></i><span> Dashboard </span>
            </a>
          </li>
          <li>
            <a href="proposals.html"><i class="fi-briefcase"></i> <span> Proposals </span></a>
          </li>
          <li>
            <a href="policies.html"><i class="fi-briefcase"></i> <span> Policies </span></a>
          </li>
          <li>
            <a href="claims.html"><i class="fi-briefcase"></i> <span> Claims </span></a>
          </li>
          <li>
            <a href="accounting.html"><i class="fi-briefcase"></i> <span> Accounting </span></a>
          </li>
          <li>
            <a href="chat.html"><i class="dripicons-message"></i> <span> Chat </span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>
  </div>
  <div class="content-page">
    <!-- Start content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="page-title-box">
              <div class="float-left"><h4 class="page-title">Chat</h4></div>
              <div class="float-right">
                <a href="javascript:void(0);" class="btn btn-primary" data-toggle="modal" data-target="#start-chat"><i class="fa fa-plus"></i> New Chat</a>
              </div>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
        <!-- end row -->
        <div class="row">
          <div class="col-sm-4">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">My Chats</h4>
              </div>
              <ul id="chats" class="list-group list-group-flush">
                <li class="list-group-item">No Chats</li>
              </ul>
            </div>
          </div><!-- end col -->
          <div class="col-sm-8">
            <div class="card">
              <div id="selected_chat" class="card-body" style="height: 500px; overflow-y: auto;">
                <h6>Select a Chat</h6>
              </div>
              <div class="card-body">
                <div class="form-group col-12">
                  <input type="text" class="form-control" name="inpMessage" placeholder="Enter Message" disabled>
                </div>
              </div>
            </div>
          </div><!-- end col -->
        </div>
        <!--- end row -->
      </div> <!-- container -->
    </div> <!-- content -->
    <!-- Button trigger modal -->    
    <!-- Modal -->
    <div class="modal fade" id="start-chat" tabindex="-1" role="dialog" aria-labelledby="start_chat" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">New Chat</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6 col-sm-12">
                <legend>Carrier Info</legend>
                <div class="row">
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="applicant_name">Company Name</label>
                    <input type="text" class="form-control" name="carrier_company" id="carrier_company" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="applicant_address">Contact Name</label>
                    <input type="text" class="form-control" name="carrier_contact" id="carrier_contact" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="applicant_address">Phone</label>
                    <input type="text" class="form-control" name="carrier_phone" id="carrier_phone" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="applicant_address">Email</label>
                    <input type="email" class="form-control" name="carrier_email" id="carrier_email" required>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-sm-12">
                <legend>Additional Insured</legend>
                <div class="row">
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="applicant_name">Name</label>
                    <input type="text" class="form-control" name="additional_name" id="additional_name" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="additional_address">Mailing Address</label>
                    <input type="text" class="form-control" name="additional_mailing_address" id="additional_mailing_address" required>
                  </div>
                  <div class="col-md-4 col-sm-12 form-group">
                    <label for="additional_address">GL Code</label>
                    <input type="text" class="form-control" name="additional_gl_code" id="additional_gl_code" required>
                  </div>
                  <div class="col-md-4 col-sm-12 form-group">
                    <label for="additional_address">SIC</label>
                    <input type="text" class="form-control" name="additional_sic" id="additional_sic" required>
                  </div>
                  <div class="col-md-4 col-sm-12 form-group">
                    <label for="additional_address">Social Security</label>
                    <input type="text" class="form-control" name="additional_ss" id="additional_ss" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="additional_address">Business Phone</label>
                    <input type="text" class="form-control" name="additional_business_phone" id="additional_business_phone" required>
                  </div>
                  <div class="col-md-6 col-sm-12 form-group">
                    <label for="additional_address">Business Type</label>
                    <select class="form-control" name="additional_business_type" id="additional_business_type">
                      <option>CORPORATION</option>
                      <option>INDIVIDUAL</option>
                      <option>JOINT VENTURE</option>
                      <option>LLC</option>
                      <option>NOT FOR PROFIT ORG</option>
                      <option>PARTNERSHIP</option>
                      <option>SUBCHAPTER "S" CORPORATION</option>
                      <option>TRUST</option>
                      <option>OTHER</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-sm-12 form-group">
                <label for="lob">Line of Business</label>
                <select class="form-control" name="lob" id="lob">
                  <option>BOILER & MACHINERY</option>
                  <option>BUSINESS AUTO</option>
                  <option>BUSINESS OWNERS</option>
                  <option>COMMERCIAL GENERAL LIABILITY</option>
                  <option>COMMERCIAL INLAND MARINE</option>
                  <option>COMMERCIAL PROPERTY</option>
                  <option>CRIME</option>
                  <option>CYBER AND PRIVACY</option>
                  <option>FIDUCIARY LIABILITY</option>
                  <option>GARAGE AND DEALERS</option>
                  <option>LIQUOR LIABILITY</option>
                  <option>MOTOR CARRIER</option>
                  <option>TRUCKERS</option>
                  <option>UMBRELLA</option>
                  <option>YACHT</option>
                </select>
              </div>
              <div class="col-md-3 col-sm-12 form-group">
                <label for="start_date">Effective From</label>
                <input type="text" class="form-control dp" name="start_date" id="start_date" readonly required>
              </div>
              <div class="col-md-3 col-sm-12 form-group">
                <label for="expire_date">Expires On</label>
                <input type="text" class="form-control dp" name="expire_date" id="expire_date" readonly required>
              </div>
              <div class="col-md-3 col-sm-12 form-group">
                <label for="attachment">Attachment</label>
                <select class="form-control" name="attachment" id="attachment">
                  <option>ACCOUNTS RECEIVABLE / VALUABLE PAPERS</option>
                  <option>ADDITIONAL INTEREST SCHEDULE</option>
                  <option>ADDITIONAL PREMISES INFORMATION SCHEDULE</option>
                  <option>APARTMENT BUILDING SUPPLEMENT</option>
                  <option>CONDO ASSN BYLAWS (for D&O Coverage only)</option>
                  <option>CONTRACTORS SUPPLEMENT</option>
                  <option>COVERAGES SCHEDULE</option>
                  <option>DEALERS SECTION</option>
                  <option>DRIVER INFORMATION SCHEDULE</option>
                  <option>ELECTRONIC DATA PROCESSING SECTION</option>
                  <option>POLICY INFORMATION</option>
                  <option>PROPOSED EFF DATE</option>
                  <option>GLASS AND SIGN SECTION</option>
                  <option>HOTEL / MOTEL SUPPLEMENT</option>
                  <option>INSTALLATION / BUILDERS RISK SECTION</option>
                  <option>INTERNATIONAL LIABILITY EXPOSURE SUPPLEMENT</option>
                  <option>INTERNATIONAL PROPERTY EXPOSURE SUPPLEMENT</option>
                  <option>LOSS SUMMARY</option>
                  <option>OPEN CARGO SECTION</option>
                  <option>PREMIUM PAYMENT SUPPLEMENT</option>
                  <option>PROFESSIONAL LIABILITY SUPPLEMENT</option>
                  <option>RESTAURANT / TAVERN SUPPLEMENT</option>
                </select>
              </div>
            </div>
            <div class="row">
              <legend>Billing</legend>
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-6">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label for="billing_plan">Plan</label>
                        <select class="form-control" name="billing_plan" id="billing_plan">
                          <option>DIRECT</option>
                          <option>AGENCY</option>
                        </select>
                      </div>
                      <div class="form-group col-md-6">
                        <label for="billing_payment_plan">Payment Plan</label>
                        <input type="text" class="form-control" name="billing_payment_plan" id="billing_payment_plan">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label for="billing_mop">Method of Payment</label>
                        <input type="text" class="form-control" name="billing_mop" id="billing_mop">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="billing_audit">Audit</label>
                        <input type="text" class="form-control" name="billing_audit" id="billing_audit">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label for="billing_deposit">Deposit</label>
                        <input type="text" class="form-control" name="billing_deposit" id="billing_deposit">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="billing_min_premium">Min. Premium</label>
                        <input type="text" class="form-control" name="billing_min_premium" id="billing_min_premium">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <legend>Premises</legend>
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-6">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-check">
                          <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" name="premises_additional" id="premises_additional">
                            Has additional premises
                          </label>
                        </div>
                      </div>
                      <div class="form-group col-md-12">
                        <label for="premises_address">Address</label>
                        <input type="text" class="form-control premises" name="premises_address" id="premises_address">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-check">
                          <label class="form-check-label">
                            <input type="checkbox" class="form-check-input premises" name="premises_city_limits" id="premises_city_limits">
                            Within city limits
                          </label>
                        </div>
                      </div>
                      <div class="form-group col-md-12">
                        <label for="premises_address">Interest</label>
                        <input type="text" class="form-control premises" name="premises_interest" id="premises_interest">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="form-group col-md-4">
                <label for="coverage_total">Total Coverage</label>
                <input type="text" class="form-control" name="coverage_total" id="coverage_total">
              </div>
              <div class="form-group col-md-4">
                <label for="coverage_amount">Coverage Amount</label>
                <input type="text" class="form-control" name="coverage_amount" id="coverage_amount">
              </div>
              <div class="form-group col-md-4">
                <label for="counterparty">Plan</label>
                <select class="form-control" name="counterparty" id="counterparty">
                  <option>InsurerA</option>
                  <option>InsurerB</option>
                </select>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" id="make_proposal" class="btn btn-primary">Save</button>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer text-right">
      2019 &copy; Apex Insure Tech
    </footer>
  </div>
</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/popper.min.js"></script><!-- Popper for Bootstrap -->
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/metisMenu.min.js"></script>
<script src="/assets/js/waves.js"></script>
<script src="/assets/js/jquery.slimscroll.js"></script>
<script src="/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<!-- Counter js  -->
<script src="/plugins/waypoints/jquery.waypoints.min.js"></script>
<script src="/plugins/counterup/jquery.counterup.min.js"></script>
<!--C3 Chart-->
<script type="text/javascript" src="/plugins/d3/d3.min.js"></script>
<script type="text/javascript" src="/plugins/c3/c3.min.js"></script>
<!--Echart Chart-->
<script src="/plugins/echart/echarts-all.js"></script>
<!-- Dashboard init -->
<script src="/assets/pages/jquery.dashboard.js"></script>
<!-- App js -->
<script src="/assets/js/jquery.core.js"></script>
<script src="/assets/js/jquery.app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
<script>
  $(function(){
    $("input[name=inpMessage]").attr("disabled", "true");
    $.ajax({
      "url": "/chat/list",
      "method": "post",
      "success": function(response){
        let chats = "";
        for(let chat of response){
          let dt = moment(chat['time']).format("YYYY-MM-DD HH:mm:ss Z");
          chats += "<li class=\"list-group-item chat\" style=\"cursor: pointer;\" data-chat-id=\""+chat["chat_id"]+"\">"+chat["last_message"]+" by "+chat["by"]+"<br><small>"+dt+"</small></li>";
        }
        $("#chats").html("");
        $("#chats").html(chats);
      }
    });
    $("input[name=inpMessage]").on("keyup", function(e){
      if(e.keyCode == 13){
        $("input[name=inpMessage]").attr("disabled", "true");
        let message = $(this).val();
        let chat_id = $(this).data("group_id")
        $.ajax({
          url: "/chat/add-message",
          method: "post",
          data: JSON.stringify({"group_id": chat_id, "message": message }),
          dataType: "json",
          contentType: 'application/json',
          processData: false,
          success: function(response){
            $.ajax({
              url: "/chat/list-messages",
              method: "post",
              data: JSON.stringify({"group_id": chat_id }),
              dataType: "json",
              contentType: 'application/json',
              processData: false,
              success: function(response){
                let messages = "";
                for(let msg of response){
                  if(msg["message"] == "") continue;
                  let dt = moment(msg['time']).format("YYYY-MM-DD HH:mm:ss Z");
                  messages += "<div style=\"border: 1px solid rgba(0,0,0,0.2); margin-top: 5px; padding: 5px 10px; border-radius: 3px; width: 50%; "+ (msg["party"] == "Me" ? "margin-left: 50%;" : "margin-right: 50%;") +"\" class=\""+ (msg["party"] == "Me" ? "float-right" : "float-left") +"\"><span>"+msg["message"]+"</span><br><small>"+msg["party"]+" @ "+dt+"</small></div>";
                }
                messages +="<div class=\"clearfix\"></div>";
                $("#selected_chat").html("");
                $("#selected_chat").html(messages);
                $("input[name=inpMessage]").data("group_id", chat_id);
                $("input[name=inpMessage]").val("");
                $("input[name=inpMessage]").removeAttr("disabled");
              }
            });
          }
        });
      }
    });
    $("body").on("click", ".chat", function(){
      let chat_id = $(this).data("chat-id");
      $.ajax({
        url: "/chat/list-messages",
        method: "post",
        data: JSON.stringify({"group_id": chat_id }),
        dataType: "json",
        contentType: 'application/json',
        processData: false,
        success: function(response){
          let messages = "";
          for(let msg of response){
            if(msg["message"] == "") continue;
            let dt = moment(msg['time']).format("YYYY-MM-DD HH:mm:ss Z");
            messages += "<div style=\"border: 1px solid rgba(0,0,0,0.2); margin-top: 5px; padding: 5px 10px; border-radius: 3px; width: 50%; "+ (msg["party"] == "Me" ? "margin-left: 50%;" : "margin-right: 50%;") +"\" class=\""+ (msg["party"] == "Me" ? "float-right" : "float-left") +"\"><span>"+msg["message"]+"</span><br><small>"+msg["party"]+" @ "+dt+"</small></div>";
          }
          messages +="<div class=\"clearfix\"></div>";
          $("#selected_chat").html("");
          $("#selected_chat").html(messages);
          $("input[name=inpMessage]").data("group_id", chat_id);
          $("input[name=inpMessage]").removeAttr("disabled");
        }
      });
    });
  });
</script>
</body>
</html>