<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Apex Labs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- App favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">
  <!-- C3 charts css -->
  <link href="../plugins/c3/c3.min.css" rel="stylesheet" type="text/css"  />
  <!-- App css -->
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/metismenu.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
  <script src="assets/js/modernizr.min.js"></script>
</head>
<body>
<!-- Begin page -->
<div id="wrapper">
  <!-- Top Bar Start -->
  <div class="topbar">
    <!-- LOGO -->
    <div class="topbar-left">
      <a href="index.html" class="logo">
        <span>
          <img src="assets/images/logo.png" alt="" height="25">
        </span>
        <i>
          <img src="assets/images/logo_sm.png" alt="" height="28">
        </i>
      </a>
    </div>
    <nav class="navbar-custom">
      <ul class="list-inline float-right mb-0">
        <li class="list-inline-item notification-list">
          <a class="nav-link dropdown-toggle arrow-none waves-light waves-effect" href="/chat.html" role="button" aria-haspopup="false" aria-expanded="false"><i class="dripicons-message noti-icon"></i></a>
        </li>
        <li class="list-inline-item dropdown notification-list">
          <a class="nav-link dropdown-toggle waves-effect waves-light nav-user" data-toggle="dropdown" href="#" role="button"
             aria-haspopup="false" aria-expanded="false">
            <img src="assets/images/users/avatar-1.jpg" alt="user" class="rounded-circle">
          </a>
          <div class="dropdown-menu dropdown-menu-right profile-dropdown " aria-labelledby="Preview">
            <!-- item-->
            <div class="dropdown-item noti-title">
              <h5 class="text-overflow"><small>Welcome User!</small> </h5>
            </div>
          </div>
        </li>
      </ul>
      <ul class="list-inline menu-left mb-0">
        <li class="float-left">
          <button class="button-menu-mobile open-left waves-light waves-effect">
            <i class="dripicons-menu"></i>
          </button>
        </li>
      </ul>
    </nav>

  </div>
  <div class="left side-menu">
    <div class="slimscroll-menu" id="remove-scroll">
      <div id="sidebar-menu">
        <ul class="metismenu" id="side-menu">
          <li class="menu-title">Navigation</li>
          <li>
            <a href="index.html">
              <i class="fi-air-play"></i><span> Dashboard </span>
            </a>
          </li>
          <li>
            <a href="proposals.html"><i class="fi-briefcase"></i> <span> Proposals </span></a>
          </li>
          <li>
            <a href="#"><i class="fi-briefcase"></i> <span> Policies </span></a>
          </li>
          <li>
            <a href="#"><i class="fi-briefcase"></i> <span> Claims </span></a>
          </li>
          <li>
            <a href="#"><i class="fi-briefcase"></i> <span> Accounting </span></a>
          </li>
        </ul>
      </div>
      <div class="clearfix"></div>
    </div>
  </div>
  <!-- ============================================================== -->
  <!-- Start right Content here -->
  <!-- ============================================================== -->
  <div class="content-page">
    <!-- Start content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="page-title-box">
              <h4 class="page-title float-left">Dashboard</h4>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
        <!-- end row -->
        <div class="row">
          <div class="col-xl-3 col-sm-6">
            <div class="card-box widget-box-two widget-two-custom">
              <i class="mdi mdi-currency-usd widget-two-icon"></i>
              <div class="wigdet-two-content">
                <p class="m-0 text-uppercase font-bold font-secondary text-overflow" title="Statistics">Revenue</p>
                <h2 class="font-600"><span><i class="mdi mdi-arrow-up"></i></span> <span id="stats_revenue">0</span></h2>
              </div>
            </div>
          </div><!-- end col -->
          <div class="col-xl-3 col-sm-6">
            <div class="card-box widget-box-two widget-two-custom">
              <i class="mdi mdi-account-multiple widget-two-icon"></i>
              <div class="wigdet-two-content">
                <p class="m-0 text-uppercase font-bold font-secondary text-overflow" title="Statistics">Deposits</p>
                <h2 class="font-600"><span><i class="mdi mdi-arrow-up"></i></span> <span id="stats_deposits">0</span></h2>
              </div>
            </div>
          </div><!-- end col -->
          <div class="col-xl-3 col-sm-6">
            <div class="card-box widget-box-two widget-two-custom">
              <i class="mdi mdi-crown widget-two-icon"></i>
              <div class="wigdet-two-content">
                <p class="m-0 text-uppercase font-bold font-secondary text-overflow" title="Statistics">Claims Reserve</p>
                <h2 class="font-600"><span><i class="mdi mdi-arrow-up"></i></span> <span data-plugin="counterup">5</span></h2>
              </div>
            </div>
          </div><!-- end col -->
          <div class="col-xl-3 col-sm-6">
            <div class="card-box widget-box-two widget-two-custom">
              <i class="mdi mdi-auto-fix widget-two-icon"></i>
              <div class="wigdet-two-content">
                <p class="m-0 text-uppercase font-bold font-secondary text-overflow" title="Statistics">Total Outstanding Claims</p>
                <h2 class="font-600"><span><i class="mdi mdi-arrow-up"></i></span> <span data-plugin="counterup">1</span></h2>
              </div>
            </div>
          </div><!-- end col -->
        </div>
        <!-- end row -->
        <div class="row">
          <div class="col-xl-4">
            <div class="card-box">
              <h4 class="header-title m-t-0 m-b-30">Business Lines</h4>
              <div class="chart-container">
                <div class="" style="height:280px" id="business-lines"></div>
              </div>
            </div>
          </div>
          <div class="col-xl-4">
            <div class="card-box">
              <h4 class="header-title m-t-0 m-b-30">Claims Overview</h4>
              <div class="chart-container">
                <div class="" style="height:280px" id="user_type_bar"></div>
              </div>
            </div>
          </div>
          <div class="col-xl-4">
            <div class="card-box">
              <h4 class="header-title m-t-0 m-b-30">Claims Ratio</h4>
              <div class="chart-container">
                <div class="chart has-fixed-height" style="height:280px" id="page_views_today"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- end row -->
        <div class="row">
          <div class="col-xl-12 col-lg-12">
            <div class="card-box">
              <div class="col-12">
                <div class="pull-left"><h4 class="m-t-0 header-title"><b>Policies</b></h4></div>
                <div class="pull-right"><button id="get-list" class="btn btn-primary" role="button"><i class="fa fa-refresh" aria-hidden="true"></i></button></div>
                <div class="clearfix"></div>
              </div>
              <div class="table-responsive">
                <table class="table table-hover m-0 table-actions-bar">
                  <thead>
                    <tr>
                      <th>Applicant Name</th>
                      <th>Broker Company</th>
                      <th>Broker Contact</th>
                      <th>Plan</th>
                      <th>Billing Premium</th>
                      <th>Billing Deposit</th>
                    </tr>
                  </thead>
                  <tbody id="proposal-data">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- container -->
    </div> <!-- content -->
    <footer class="footer text-right">
      2019 &copy; Apex Labs
    </footer>
  </div>
  <!-- ============================================================== -->
  <!-- End Right content here -->
  <!-- ============================================================== -->
</div>
<!-- END wrapper -->
<!-- jQuery  -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/popper.min.js"></script><!-- Popper for Bootstrap -->
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/metisMenu.min.js"></script>
<script src="assets/js/waves.js"></script>
<script src="assets/js/jquery.slimscroll.js"></script>
<!-- Counter js  -->
<script src="../plugins/waypoints/jquery.waypoints.min.js"></script>
<script src="../plugins/counterup/jquery.counterup.min.js"></script>
<!--C3 Chart-->
<script type="text/javascript" src="../plugins/d3/d3.min.js"></script>
<script type="text/javascript" src="../plugins/c3/c3.min.js"></script>
<!--Echart Chart-->
<script src="../plugins/echart/echarts-all.js"></script>
<!-- Dashboard init -->
<script src="assets/pages/jquery.dashboard.js"></script>
<!-- App js -->
<script src="assets/js/jquery.core.js"></script>
<script src="assets/js/jquery.app.js"></script>
<script>
  $(function(){
    $("button#get-list").on("click", function(e){
      $.ajax({
        "url": "/dashboard/policies",
        "method": "post",
        "success": function(response){
          let data = "";
          for (let proposal of response) {
            data += "<tr>";
            data += "<td>"+proposal["applicant_name"]+"</td>";
            data += "<td>"+proposal["broker_company"]+"</td>";
            data += "<td>"+proposal["broker_contact"]+"</td>";
            data += "<td>"+proposal["billing_plan"]+"</td>";
            data += "<td>"+proposal["billing_premium"]+"</td>";
            data += "<td>"+proposal["billing_deposit"]+"</td>";
            data += "</tr>";
          }
          $("#proposal-data").html("");
          $("#proposal-data").html(data);
        }
      });
    });
    $("button#get-list").click();
    $.ajax({
      "url": "/dashboard/stats",
      "method": "post",
      "success": function(response){
        for(let item in response){
          $("#stats_"+item).html(response[item]);
        }
      }
    });
    $.ajax({
      url: "/dashboard/business-lines",
      method: "post",
      success: function(response){
        let labels = [];
        let values = [];
        let show = 0;
        for (let x in response){
          show += response[x] > 0 ? 1 : 0;
          labels.push(x);
          values.push({name: x, value: response[x]});
        }
        if(show === 0){
          $('#business-lines').html("<span>No Data found. Graph will appear after you've added a few proposals.</span>");
          return;
        }
        let myChart = echarts.init(document.getElementById('business-lines'));
        let option_dt = {
          title : {
            text: '',
            subtext: ''
          },
          tooltip : {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
          },
          legend: {
            show: false,
            x: 'left',
            orient:'vertical',
            padding: 0,
            data: labels,
          },
          series : [
            {
              type:'pie',
              radius : [20, '80%'],
              roseType : 'none',
              center: ['50%', '45%'],
              width: '50%',       // for funnel
              itemStyle : {
                normal : { label : { show : true }, labelLine : { show : true } },
                emphasis : { label : { show : false }, labelLine : {show : false} }
              },
              data:values,
            }
          ]
        };
        console.log(option_dt);
        myChart.setOption(option_dt);
      }
    })
  });
</script>
</body>
</html>